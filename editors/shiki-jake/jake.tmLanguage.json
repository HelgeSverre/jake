{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "jake",
  "scopeName": "source.jake",
  "patterns": [
    { "include": "#comments" },
    { "include": "#imports" },
    { "include": "#global-directives" },
    { "include": "#variables" },
    { "include": "#recipes" }
  ],
  "repository": {
    "comments": {
      "name": "comment.line.number-sign.jake",
      "match": "#.*$"
    },

    "imports": {
      "patterns": [
        {
          "name": "meta.import.jake",
          "match": "^(@import)\\s+(\"[^\"]*\"|'[^']*')(?:\\s+(as)\\s+([a-zA-Z_][a-zA-Z0-9_]*))?",
          "captures": {
            "1": { "name": "keyword.control.import.jake" },
            "2": { "name": "string.quoted.jake" },
            "3": { "name": "keyword.control.as.jake" },
            "4": { "name": "entity.name.namespace.jake" }
          }
        }
      ]
    },

    "global-directives": {
      "patterns": [
        {
          "name": "meta.directive.dotenv.jake",
          "match": "^(@dotenv)(?:\\s+(\"[^\"]*\"|'[^']*'|[^\\s#]+))?",
          "captures": {
            "1": { "name": "keyword.control.directive.jake" },
            "2": { "name": "string.unquoted.jake" }
          }
        },
        {
          "name": "meta.directive.require.jake",
          "match": "^(@require)\\s+(.+)$",
          "captures": {
            "1": { "name": "keyword.control.directive.jake" },
            "2": { "name": "variable.other.constant.jake" }
          }
        },
        {
          "name": "meta.directive.export.jake",
          "match": "^(@export)\\s+([a-zA-Z_][a-zA-Z0-9_]*)(?:\\s*=\\s*(.*))?$",
          "captures": {
            "1": { "name": "keyword.control.directive.jake" },
            "2": { "name": "variable.other.constant.jake" },
            "3": { "name": "string.unquoted.jake" }
          }
        },
        {
          "name": "meta.directive.hook.jake",
          "match": "^(@(?:pre|post|on_error))\\s+(.*)$",
          "captures": {
            "1": { "name": "keyword.control.directive.jake" },
            "2": { "patterns": [{ "include": "#shell-content" }] }
          }
        },
        {
          "name": "meta.directive.hook-targeted.jake",
          "match": "^(@(?:before|after))\\s+([a-zA-Z_][a-zA-Z0-9_-]*)\\s+(.*)$",
          "captures": {
            "1": { "name": "keyword.control.directive.jake" },
            "2": { "name": "entity.name.function.jake" },
            "3": { "patterns": [{ "include": "#shell-content" }] }
          }
        },
        {
          "name": "meta.directive.default.jake",
          "match": "^(@default)\\s*$",
          "captures": {
            "1": { "name": "keyword.control.directive.jake" }
          }
        }
      ]
    },

    "variables": {
      "patterns": [
        {
          "name": "meta.variable.jake",
          "match": "^([a-zA-Z_][a-zA-Z0-9_]*)\\s*(=|:=)\\s*(.*)$",
          "captures": {
            "1": { "name": "variable.other.jake" },
            "2": { "name": "keyword.operator.assignment.jake" },
            "3": { "patterns": [{ "include": "#value-content" }] }
          }
        }
      ]
    },

    "recipes": {
      "patterns": [
        {
          "name": "meta.recipe.file.jake",
          "begin": "^(file)\\s+([^:]+):\\s*(.*)$",
          "beginCaptures": {
            "1": { "name": "keyword.control.recipe.jake" },
            "2": { "name": "entity.name.function.jake" },
            "3": { "name": "string.unquoted.dependency.jake" }
          },
          "end": "^(?=\\S)",
          "patterns": [{ "include": "#recipe-body" }]
        },
        {
          "name": "meta.recipe.task.jake",
          "begin": "^(task)\\s+([a-zA-Z_][a-zA-Z0-9_-]*)([^:]*):\\s*(?:\\[([^\\]]*)\\])?",
          "beginCaptures": {
            "1": { "name": "keyword.control.recipe.jake" },
            "2": { "name": "entity.name.function.jake" },
            "3": { "patterns": [{ "include": "#parameters" }] },
            "4": { "patterns": [{ "include": "#dependency-list" }] }
          },
          "end": "^(?=\\S)",
          "patterns": [{ "include": "#recipe-body" }]
        },
        {
          "name": "meta.recipe.simple.jake",
          "begin": "^([a-zA-Z_][a-zA-Z0-9_-]*):\\s*(?:\\[([^\\]]*)\\])?\\s*$",
          "beginCaptures": {
            "1": { "name": "entity.name.function.jake" },
            "2": { "patterns": [{ "include": "#dependency-list" }] }
          },
          "end": "^(?=\\S)",
          "patterns": [{ "include": "#recipe-body" }]
        }
      ]
    },

    "parameters": {
      "patterns": [
        {
          "match": "([a-zA-Z_][a-zA-Z0-9_]*)\\s*=\\s*(\"[^\"]*\"|'[^']*'|[^\\s,]+)",
          "captures": {
            "1": { "name": "variable.parameter.jake" },
            "2": { "name": "string.quoted.jake" }
          }
        },
        {
          "match": "([a-zA-Z_][a-zA-Z0-9_]*)(?=\\s|:|,|$)",
          "name": "variable.parameter.jake"
        }
      ]
    },

    "dependency-list": {
      "patterns": [
        {
          "match": "[a-zA-Z_][a-zA-Z0-9_:-]*",
          "name": "entity.name.function.dependency.jake"
        }
      ]
    },

    "recipe-body": {
      "patterns": [
        { "include": "#comments" },
        { "include": "#recipe-directives" },
        { "include": "#shell-line" }
      ]
    },

    "recipe-directives": {
      "patterns": [
        {
          "name": "meta.directive.conditional.jake",
          "match": "^\\s*(@(?:if|elif))\\s+(.*)$",
          "captures": {
            "1": { "name": "keyword.control.conditional.jake" },
            "2": { "patterns": [{ "include": "#condition-expression" }] }
          }
        },
        {
          "name": "keyword.control.conditional.jake",
          "match": "^\\s*@(?:else|end)\\b"
        },
        {
          "name": "meta.directive.each.jake",
          "match": "^\\s*(@each)\\s+(.*)$",
          "captures": {
            "1": { "name": "keyword.control.loop.jake" },
            "2": { "patterns": [{ "include": "#value-content" }] }
          }
        },
        {
          "name": "meta.directive.needs.jake",
          "match": "^\\s*(@needs)\\s+(.*)$",
          "captures": {
            "1": { "name": "keyword.control.directive.jake" },
            "2": { "name": "string.unquoted.command.jake" }
          }
        },
        {
          "name": "meta.directive.confirm.jake",
          "match": "^\\s*(@confirm)(?:\\s+(\"[^\"]*\"|'[^']*'|.*))?$",
          "captures": {
            "1": { "name": "keyword.control.directive.jake" },
            "2": { "name": "string.quoted.jake" }
          }
        },
        {
          "name": "meta.directive.cache.jake",
          "match": "^\\s*(@cache)\\s+(.*)$",
          "captures": {
            "1": { "name": "keyword.control.directive.jake" },
            "2": { "name": "string.unquoted.path.jake" }
          }
        },
        {
          "name": "meta.directive.watch.jake",
          "match": "^\\s*(@watch)\\s+(.*)$",
          "captures": {
            "1": { "name": "keyword.control.directive.jake" },
            "2": { "name": "string.unquoted.path.jake" }
          }
        },
        {
          "name": "meta.directive.cd.jake",
          "match": "^\\s*(@cd)\\s+(.*)$",
          "captures": {
            "1": { "name": "keyword.control.directive.jake" },
            "2": { "name": "string.unquoted.path.jake" }
          }
        },
        {
          "name": "meta.directive.shell.jake",
          "match": "^\\s*(@shell)\\s+(.*)$",
          "captures": {
            "1": { "name": "keyword.control.directive.jake" },
            "2": { "name": "string.unquoted.shell.jake" }
          }
        },
        {
          "name": "meta.directive.group.jake",
          "match": "^\\s*(@group)\\s+(.*)$",
          "captures": {
            "1": { "name": "keyword.control.directive.jake" },
            "2": { "name": "string.unquoted.group.jake" }
          }
        },
        {
          "name": "meta.directive.desc.jake",
          "match": "^\\s*(@(?:desc|description))\\s+(\"[^\"]*\"|'[^']*'|.*)$",
          "captures": {
            "1": { "name": "keyword.control.directive.jake" },
            "2": { "name": "string.quoted.jake" }
          }
        },
        {
          "name": "meta.directive.alias.jake",
          "match": "^\\s*(@alias)\\s+(.*)$",
          "captures": {
            "1": { "name": "keyword.control.directive.jake" },
            "2": { "name": "entity.name.function.alias.jake" }
          }
        },
        {
          "name": "keyword.control.directive.jake",
          "match": "^\\s*@(?:quiet|ignore)\\b"
        },
        {
          "name": "meta.directive.platform.jake",
          "match": "^\\s*(@(?:only|only-os|platform))\\s+(.*)$",
          "captures": {
            "1": { "name": "keyword.control.directive.jake" },
            "2": { "name": "constant.language.platform.jake" }
          }
        },
        {
          "name": "meta.directive.require.jake",
          "match": "^\\s*(@require)\\s+(.*)$",
          "captures": {
            "1": { "name": "keyword.control.directive.jake" },
            "2": { "name": "variable.other.constant.jake" }
          }
        },
        {
          "name": "meta.directive.export.jake",
          "match": "^\\s*(@export)\\s+([a-zA-Z_][a-zA-Z0-9_]*)(?:\\s*=\\s*(.*))?$",
          "captures": {
            "1": { "name": "keyword.control.directive.jake" },
            "2": { "name": "variable.other.constant.jake" },
            "3": { "patterns": [{ "include": "#value-content" }] }
          }
        },
        {
          "name": "meta.directive.hook.jake",
          "match": "^\\s*(@(?:pre|post))\\s+(.*)$",
          "captures": {
            "1": { "name": "keyword.control.directive.jake" },
            "2": { "patterns": [{ "include": "#shell-content" }] }
          }
        }
      ]
    },

    "condition-expression": {
      "patterns": [
        {
          "match": "\\b(env|exists|eq|neq|is_watching|is_dry_run|is_verbose)\\s*\\(",
          "captures": {
            "1": { "name": "support.function.condition.jake" }
          }
        },
        { "include": "#strings" },
        { "include": "#jake-variables" },
        {
          "match": "[a-zA-Z_][a-zA-Z0-9_]*",
          "name": "variable.other.jake"
        }
      ]
    },

    "shell-line": {
      "patterns": [
        {
          "name": "meta.shell-line.jake",
          "begin": "^(\\s+)(?!@|#)",
          "end": "$",
          "patterns": [{ "include": "#shell-content" }]
        }
      ]
    },

    "shell-content": {
      "patterns": [
        { "include": "#jake-variables" },
        { "include": "#shell-variables" },
        { "include": "#strings" }
      ]
    },

    "value-content": {
      "patterns": [
        { "include": "#jake-variables" },
        { "include": "#shell-variables" },
        { "include": "#strings" }
      ]
    },

    "jake-variables": {
      "patterns": [
        {
          "name": "meta.variable.interpolation.jake",
          "begin": "\\{\\{",
          "beginCaptures": {
            "0": { "name": "punctuation.definition.variable.begin.jake" }
          },
          "end": "\\}\\}",
          "endCaptures": {
            "0": { "name": "punctuation.definition.variable.end.jake" }
          },
          "patterns": [
            {
              "match": "\\b(dirname|basename|extension|without_extension|without_extensions|absolute_path|abs_path|uppercase|lowercase|trim|home|local_bin|shell_config|env|exists|eq|neq|is_watching|is_dry_run|is_verbose)\\s*\\(",
              "captures": {
                "1": { "name": "support.function.jake" }
              }
            },
            {
              "match": "[a-zA-Z_][a-zA-Z0-9_]*",
              "name": "variable.other.bracket.jake"
            }
          ],
          "contentName": "variable.other.bracket.jake"
        }
      ]
    },

    "shell-variables": {
      "patterns": [
        {
          "match": "\\$\\{[a-zA-Z_][a-zA-Z0-9_]*\\}",
          "name": "variable.language.environment.jake"
        },
        {
          "match": "\\$[a-zA-Z_][a-zA-Z0-9_]*",
          "name": "variable.language.environment.jake"
        },
        {
          "match": "\\$[0-9@]",
          "name": "variable.language.positional.jake"
        }
      ]
    },

    "strings": {
      "patterns": [
        {
          "name": "string.quoted.double.jake",
          "begin": "\"",
          "end": "\"",
          "patterns": [
            { "include": "#jake-variables" },
            { "include": "#shell-variables" },
            {
              "match": "\\\\[nrt\"'\\\\]",
              "name": "constant.character.escape.jake"
            }
          ]
        },
        {
          "name": "string.quoted.single.jake",
          "begin": "'",
          "end": "'",
          "patterns": [
            {
              "match": "\\\\[nrt\"'\\\\]",
              "name": "constant.character.escape.jake"
            }
          ]
        }
      ]
    }
  }
}
