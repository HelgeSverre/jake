---
// Interactive syntax highlighting demo - shows all three JS libraries
---

<div class="syntax-demo">
  <div class="demo-panel" id="hljs-panel">
    <div class="panel-header">
      <span class="panel-title">highlight.js</span>
      <span class="panel-badge" id="hljs-status">Loading...</span>
    </div>
    <pre class="demo-code"><code id="hljs-code" class="hljs"></code></pre>
  </div>

  <div class="demo-panel" id="shiki-panel">
    <div class="panel-header">
      <span class="panel-title">Shiki</span>
      <span class="panel-badge" id="shiki-status">Loading...</span>
    </div>
    <div class="demo-code" id="shiki-output"></div>
  </div>

  <div class="demo-panel" id="prism-panel">
    <div class="panel-header">
      <span class="panel-title">Prism.js</span>
      <span class="panel-badge" id="prism-status">Loading...</span>
    </div>
    <pre class="demo-code"><code id="prism-code"></code></pre>
  </div>
</div>

<script id="jake-sample" type="text/plain"># Example Jakefile
VERSION = "1.0.0"
OUTPUT = "dist/{{lowercase(PROJECT)}}"

@import "jake/build.jake" as build
@dotenv .env.local
@require API_KEY

@group build
@desc "Build the project"
task build: [clean, prepare]
    @needs gcc make
    @if env(DEBUG)
        echo "Debug mode: {{VERSION}}"
    @else
        echo "Building release..."
    @end
    make -j$(nproc)

file dist/app.js: [src/**/*.ts]
    @cache src/**/*.ts
    npm run build
    echo "Built $@"</script>

<script id="jake-grammar" type="application/json">{"$schema":"https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json","name":"jake","scopeName":"source.jake","patterns":[{"include":"#comments"},{"include":"#imports"},{"include":"#global-directives"},{"include":"#variables"},{"include":"#recipes"}],"repository":{"comments":{"name":"comment.line.number-sign.jake","match":"#.*$"},"imports":{"patterns":[{"name":"meta.import.jake","match":"^(@import)\\s+(\"[^\"]*\"|'[^']*')(?:\\s+(as)\\s+([a-zA-Z_][a-zA-Z0-9_]*))?","captures":{"1":{"name":"keyword.control.import.jake"},"2":{"name":"string.quoted.jake"},"3":{"name":"keyword.control.as.jake"},"4":{"name":"entity.name.namespace.jake"}}}]},"global-directives":{"patterns":[{"name":"meta.directive.dotenv.jake","match":"^(@dotenv)(?:\\s+(\"[^\"]*\"|'[^']*'|[^\\s#]+))?","captures":{"1":{"name":"keyword.control.directive.jake"},"2":{"name":"string.unquoted.jake"}}},{"name":"meta.directive.require.jake","match":"^(@require)\\s+(.+)$","captures":{"1":{"name":"keyword.control.directive.jake"},"2":{"name":"variable.other.constant.jake"}}},{"name":"meta.directive.export.jake","match":"^(@export)\\s+([a-zA-Z_][a-zA-Z0-9_]*)(?:\\s*=\\s*(.*))?$","captures":{"1":{"name":"keyword.control.directive.jake"},"2":{"name":"variable.other.constant.jake"},"3":{"name":"string.unquoted.jake"}}},{"name":"meta.directive.hook.jake","match":"^(@(?:pre|post|on_error))\\s+(.*)$","captures":{"1":{"name":"keyword.control.directive.jake"},"2":{"patterns":[{"include":"#shell-content"}]}}},{"name":"meta.directive.default.jake","match":"^(@default)\\s*$","captures":{"1":{"name":"keyword.control.directive.jake"}}}]},"variables":{"patterns":[{"name":"meta.variable.jake","match":"^([a-zA-Z_][a-zA-Z0-9_]*)\\s*(=|:=)\\s*(.*)$","captures":{"1":{"name":"variable.other.jake"},"2":{"name":"keyword.operator.assignment.jake"},"3":{"patterns":[{"include":"#value-content"}]}}}]},"recipes":{"patterns":[{"name":"meta.recipe.file.jake","begin":"^(file)\\s+([^:]+):\\s*(.*)$","beginCaptures":{"1":{"name":"keyword.control.recipe.jake"},"2":{"name":"entity.name.function.jake"},"3":{"name":"string.unquoted.dependency.jake"}},"end":"^(?=\\S)","patterns":[{"include":"#recipe-body"}]},{"name":"meta.recipe.task.jake","begin":"^(task)\\s+([a-zA-Z_][a-zA-Z0-9_-]*)([^:]*):\\s*(?:\\[([^\\]]*)\\])?","beginCaptures":{"1":{"name":"keyword.control.recipe.jake"},"2":{"name":"entity.name.function.jake"},"3":{"patterns":[{"include":"#parameters"}]},"4":{"patterns":[{"include":"#dependency-list"}]}},"end":"^(?=\\S)","patterns":[{"include":"#recipe-body"}]},{"name":"meta.recipe.simple.jake","begin":"^([a-zA-Z_][a-zA-Z0-9_-]*):\\s*(?:\\[([^\\]]*)\\])?\\s*$","beginCaptures":{"1":{"name":"entity.name.function.jake"},"2":{"patterns":[{"include":"#dependency-list"}]}},"end":"^(?=\\S)","patterns":[{"include":"#recipe-body"}]}]},"parameters":{"patterns":[{"match":"([a-zA-Z_][a-zA-Z0-9_]*)\\s*=\\s*(\"[^\"]*\"|'[^']*'|[^\\s,]+)","captures":{"1":{"name":"variable.parameter.jake"},"2":{"name":"string.quoted.jake"}}},{"match":"([a-zA-Z_][a-zA-Z0-9_]*)(?=\\s|:|,|$)","name":"variable.parameter.jake"}]},"dependency-list":{"patterns":[{"match":"[a-zA-Z_][a-zA-Z0-9_:-]*","name":"entity.name.function.dependency.jake"}]},"recipe-body":{"patterns":[{"include":"#comments"},{"include":"#recipe-directives"},{"include":"#shell-line"}]},"recipe-directives":{"patterns":[{"name":"meta.directive.conditional.jake","match":"^\\s*(@(?:if|elif))\\s+(.*)$","captures":{"1":{"name":"keyword.control.conditional.jake"},"2":{"patterns":[{"include":"#condition-expression"}]}}},{"name":"keyword.control.conditional.jake","match":"^\\s*@(?:else|end)\\b"},{"name":"meta.directive.each.jake","match":"^\\s*(@each)\\s+(.*)$","captures":{"1":{"name":"keyword.control.loop.jake"},"2":{"patterns":[{"include":"#value-content"}]}}},{"name":"meta.directive.needs.jake","match":"^\\s*(@needs)\\s+(.*)$","captures":{"1":{"name":"keyword.control.directive.jake"},"2":{"name":"string.unquoted.command.jake"}}},{"name":"meta.directive.confirm.jake","match":"^\\s*(@confirm)(?:\\s+(\"[^\"]*\"|'[^']*'|.*))?$","captures":{"1":{"name":"keyword.control.directive.jake"},"2":{"name":"string.quoted.jake"}}},{"name":"meta.directive.cache.jake","match":"^\\s*(@cache)\\s+(.*)$","captures":{"1":{"name":"keyword.control.directive.jake"},"2":{"name":"string.unquoted.path.jake"}}},{"name":"meta.directive.cd.jake","match":"^\\s*(@cd)\\s+(.*)$","captures":{"1":{"name":"keyword.control.directive.jake"},"2":{"name":"string.unquoted.path.jake"}}},{"name":"meta.directive.group.jake","match":"^\\s*(@group)\\s+(.*)$","captures":{"1":{"name":"keyword.control.directive.jake"},"2":{"name":"string.unquoted.group.jake"}}},{"name":"meta.directive.desc.jake","match":"^\\s*(@(?:desc|description))\\s+(\"[^\"]*\"|'[^']*'|.*)$","captures":{"1":{"name":"keyword.control.directive.jake"},"2":{"name":"string.quoted.jake"}}},{"name":"keyword.control.directive.jake","match":"^\\s*@(?:quiet|ignore)\\b"},{"name":"meta.directive.require.jake","match":"^\\s*(@require)\\s+(.*)$","captures":{"1":{"name":"keyword.control.directive.jake"},"2":{"name":"variable.other.constant.jake"}}},{"name":"meta.directive.export.jake","match":"^\\s*(@export)\\s+([a-zA-Z_][a-zA-Z0-9_]*)(?:\\s*=\\s*(.*))?$","captures":{"1":{"name":"keyword.control.directive.jake"},"2":{"name":"variable.other.constant.jake"},"3":{"patterns":[{"include":"#value-content"}]}}}]},"condition-expression":{"patterns":[{"match":"\\b(env|exists|eq|neq|is_watching|is_dry_run|is_verbose)\\s*\\(","captures":{"1":{"name":"support.function.condition.jake"}}},{"include":"#strings"},{"include":"#jake-variables"},{"match":"[a-zA-Z_][a-zA-Z0-9_]*","name":"variable.other.jake"}]},"shell-line":{"patterns":[{"name":"meta.shell-line.jake","begin":"^(\\s+)(?!@|#)","end":"$","patterns":[{"include":"#shell-content"}]}]},"shell-content":{"patterns":[{"include":"#jake-variables"},{"include":"#shell-variables"},{"include":"#strings"}]},"value-content":{"patterns":[{"include":"#jake-variables"},{"include":"#shell-variables"},{"include":"#strings"}]},"jake-variables":{"patterns":[{"name":"meta.variable.interpolation.jake","begin":"\\{\\{","beginCaptures":{"0":{"name":"punctuation.definition.variable.begin.jake"}},"end":"\\}\\}","endCaptures":{"0":{"name":"punctuation.definition.variable.end.jake"}},"patterns":[{"match":"\\b(dirname|basename|extension|without_extension|uppercase|lowercase|trim|home|local_bin|shell_config|env|exists|eq|neq)\\s*\\(","captures":{"1":{"name":"support.function.jake"}}},{"match":"[a-zA-Z_][a-zA-Z0-9_]*","name":"variable.other.bracket.jake"}],"contentName":"variable.other.bracket.jake"}]},"shell-variables":{"patterns":[{"match":"\\$\\{[a-zA-Z_][a-zA-Z0-9_]*\\}","name":"variable.language.environment.jake"},{"match":"\\$[a-zA-Z_][a-zA-Z0-9_]*","name":"variable.language.environment.jake"},{"match":"\\$[0-9@]","name":"variable.language.positional.jake"}]},"strings":{"patterns":[{"name":"string.quoted.double.jake","begin":"\"","end":"\"","patterns":[{"include":"#jake-variables"},{"include":"#shell-variables"},{"match":"\\\\[nrt\"'\\\\]","name":"constant.character.escape.jake"}]},{"name":"string.quoted.single.jake","begin":"'","end":"'","patterns":[{"match":"\\\\[nrt\"'\\\\]","name":"constant.character.escape.jake"}]}]}}}</script>

<style>
  .syntax-demo {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    margin: 2rem 0;
  }

  .demo-panel {
    background: var(--sl-color-gray-6, #0d1117);
    border: 1px solid var(--sl-color-gray-5, #30363d);
    border-radius: 6px;
    overflow: hidden;
  }

  .panel-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 1rem;
    background: var(--sl-color-gray-5, #161b22);
    border-bottom: 1px solid var(--sl-color-gray-5, #30363d);
  }

  .panel-title {
    font-family: var(--sl-font-system-mono, 'SF Mono', monospace);
    font-size: 0.8125rem;
    font-weight: 500;
    color: var(--sl-color-gray-2, #8b949e);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .panel-badge {
    font-family: var(--sl-font-system-mono, monospace);
    font-size: 0.6875rem;
    padding: 0.2rem 0.5rem;
    border-radius: 3px;
    background: var(--sl-color-gray-4, #30363d);
    color: var(--sl-color-gray-2, #8b949e);
  }

  .panel-badge.ok {
    background: #238636;
    color: #fff;
  }

  .panel-badge.error {
    background: #da3633;
    color: #fff;
  }

  .demo-code {
    margin: 0;
    padding: 1rem;
    overflow-x: auto;
    background: transparent !important;
  }

  .demo-code pre {
    margin: 0;
    padding: 0;
    background: transparent !important;
  }

  .demo-code code,
  #shiki-output code {
    font-family: var(--sl-font-system-mono, 'SF Mono', 'Fira Code', monospace) !important;
    font-size: 0.8125rem;
    line-height: 1.6;
  }

  #shiki-output pre {
    margin: 0;
    padding: 0;
    background: transparent !important;
  }
</style>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/github-dark.min.css" id="hljs-theme">

<script>
  const sampleCode = document.getElementById('jake-sample').textContent;
  const grammar = JSON.parse(document.getElementById('jake-grammar').textContent);

  function loadScript(src) {
    return new Promise((resolve, reject) => {
      const s = document.createElement('script');
      s.src = src;
      s.onload = resolve;
      s.onerror = () => reject(new Error(`Failed: ${src}`));
      document.head.appendChild(s);
    });
  }

  // highlight.js - using Jakefile.register() API
  async function initHljs() {
    try {
      if (typeof hljs === 'undefined') {
        await loadScript('https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js');
      }
      if (typeof Jakefile === 'undefined' || !Jakefile.definition) {
        await loadScript('/libs/highlightjs-jake.min.js');
      }
      Jakefile.register(hljs);
      document.getElementById('hljs-code').innerHTML = hljs.highlight(sampleCode, {language: 'jake'}).value;
      document.getElementById('hljs-status').textContent = 'OK';
      document.getElementById('hljs-status').className = 'panel-badge ok';
    } catch (e) {
      document.getElementById('hljs-status').textContent = 'Error';
      document.getElementById('hljs-status').className = 'panel-badge error';
      document.getElementById('hljs-code').textContent = sampleCode;
    }
  }

  // Shiki
  async function initShiki() {
    try {
      const shiki = await import('https://esm.sh/shiki@3.20.0');
      const highlighter = await shiki.createHighlighter({
        themes: ['github-dark'],
        langs: [{name: 'jake', scopeName: grammar.scopeName, ...grammar}]
      });
      const html = highlighter.codeToHtml(sampleCode, {lang: 'jake', theme: 'github-dark'});
      document.getElementById('shiki-output').innerHTML = html;
      document.getElementById('shiki-status').textContent = 'OK';
      document.getElementById('shiki-status').className = 'panel-badge ok';
    } catch (e) {
      document.getElementById('shiki-status').textContent = 'Error';
      document.getElementById('shiki-status').className = 'panel-badge error';
      document.getElementById('shiki-output').innerHTML = `<pre><code>${sampleCode}</code></pre>`;
    }
  }

  // Prism - using Jakefile.register() API
  async function initPrism() {
    try {
      if (typeof Prism === 'undefined') {
        window.Prism = window.Prism || {};
        Prism.manual = true;
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = 'https://cdn.jsdelivr.net/gh/katorlys/prism-theme-github/themes/prism-theme-github-dark.css';
        document.head.appendChild(link);
        await loadScript('https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js');
      }
      await loadScript('/libs/prism-jake.min.js');
      // Jakefile.register() is called automatically, but we can call it explicitly too
      Jakefile.register(Prism);
      document.getElementById('prism-code').innerHTML = Prism.highlight(sampleCode, Prism.languages.jake, 'jake');
      document.getElementById('prism-status').textContent = 'OK';
      document.getElementById('prism-status').className = 'panel-badge ok';
    } catch (e) {
      document.getElementById('prism-status').textContent = 'Error';
      document.getElementById('prism-status').className = 'panel-badge error';
      document.getElementById('prism-code').textContent = sampleCode;
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    initHljs();
    initShiki();
    initPrism();
  });
</script>
